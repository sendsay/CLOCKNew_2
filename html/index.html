<!-- TODO: Add weather on off from web -->
<!-- TODO: Move all styles from html to css -->




<!DOCTYPE html>
<html lang="en">
<head>
  <title>Clock at.</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body  onload="getData()">

  <header>
    <div class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top" >
      <div class="row mx-auto">
        <div class="col" style="width: 100%;">
        <img class="logo rounded-circle" src="logo.png" alt="Clock at.">
        </div>
        <div class="col" style="width: 190%;">
        <h2 class="logo-text">Clock at.</h2>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-sm">
        <div class="card mx-auto ">
          <div class="card-header">
            WIFI
          </div>
          <div class="card-body">
            <h4>SSID name:</h4>
            <input id="ssid" type="text" class="form-control" title="Max. 15 simbols" pattern="[-\w\s#@/]{1,15}" placeholder="example: myHOME">
            <h4>SSID password :</h4>
            <input id="password" type="text" class="form-control" title="Min. 8 and Max. 15 simbols" pattern=".{8,15}" placeholder="example: 12345678" >
            <h4>AP name:</h4>
            <input id="ssidAP" type="text" class="form-control"  title="Max. 15 simbols" pattern="[-\w\s#@/]{1,15}" placeholder="example: ClockAt">
            <h4>AP password :</h4>
            <input id="passwordAP" type="text" class="form-control" title="Min. 8 and Max. 15 simbols" pattern=".{8,15}" placeholder="example: 12345678">
          </div>
        </div>
      </div>

      <div class="col-sm">
        <div class="card mx-auto">
          <div class="card-header">
            Time
          </div>
          <div class="card-body">
            <h4>Ntp server:</h4>
            <input id="ntpServerName" type="text" class="form-control" title="Min. 1 Max. 20 simbols" pattern="[0-9a-zA-Z. ]{1,20}" placeholder="example: ntp3.time.in.ua">
            <h4>Time zone: :</h4>
            <select id="timezone" class="custom-select">
              <option value="-12.00"> (GMT) -12:00 </option>
              <option value="-11.00"> (GMT) -11:00 </option>
              <option value="-10.00"> (GMT) -10:00 </option>
              <option value="-9.00" > (GMT) -09:00 </option>
              <option value="-8.00" > (GMT) -08:00 </option>
              <option value="-7.00" > (GMT) -07:00 </option>
              <option value="-6.00" > (GMT) -06:00 </option>
              <option value="-5.00" > (GMT) -05:00 </option>
              <option value="-4.00" > (GMT) -04:00 </option>
              <option value="-3.50" > (GMT) -03:30 </option>
              <option value="-3.00" > (GMT) -03:00 </option>
              <option value="-2.00" > (GMT) -02:00 </option>
              <option value="-1.00" > (GMT) -01:00 </option>
              <option value="0.00"  > (GMT) +00:00 </option>
              <option value="1.00"  > (GMT) +01:00 </option>
              <option value="2.00"  > (GMT) +02:00 </option>
              <option value="3.00"  > (GMT) +03:00 </option>
              <option value="3.50"  > (GMT) +03:30 </option>
              <option value="4.00"  > (GMT) +04:00 </option>
              <option value="4.50"  > (GMT) +04:30 </option>
              <option value="5.00"  > (GMT) +05:00 </option>
              <option value="5.50"  > (GMT) +05:30 </option>
              <option value="5.75"  > (GMT) +05:45 </option>
              <option value="6.00"  > (GMT) +06:00 </option>
              <option value="6.50"  > (GMT) +06:30 </option>
              <option value="7.00"  > (GMT) +07:00 </option>
              <option value="8.00"  > (GMT) +08:00 </option>
              <option value="8.50"  > (GMT) +08:30 </option>
              <option value="8.75"  > (GMT) +08:45 </option>
              <option value="9.00"  > (GMT) +09:00 </option>
              <option value="9.50"  > (GMT) +09:30 </option>
              <option value="10.00" > (GMT) +10:00 </option>
              <option value="10.50" > (GMT) +10:30 </option>
              <option value="11.00" > (GMT) +11:00 </option>
              <option value="12.00" > (GMT) +12:00 </option>
              <option value="12.75" > (GMT) +12:45 </option>
              <option value="13.00" > (GMT) +13:00 </option>
              <option value="14.00" > (GMT) +14:00 </option>
            </select>

            <div class="row" style="margin-left: -12px; margin-top: 10px; margin-bottom: 7px; font-size: 20px;">
                <p id="labelsummertime" style="margin-right: 12px;"> <h4>Summer time :</h4> </p>
                <label class="switch" style="margin-left: 50px; margin-top: -3px;">
                    <input type="checkbox" id="summerTime"><span class="slider"></span>
                </label>
            </div>

            <h4>Hour signal on :</h4>
            <input id="sigOn" type="text" pattern="[0-9]{1,2}" class="form-control" placeholder="example: 7">

            <h4>Hour signal off :</h4>
            <input id="sigOff" type="numer" pattern="[0-9]{1,2}" class="form-control" placeholder="example: 21">
          </div>
        </div>
      </div>
    </div>

  <div class="row">
    <div class="col-sm">
      <div class="col-sm">
        <div class="card mx-auto">
          <div class="card-header">
            Weather
          </div>
          <div class="card-body">
            <h4>API Key:</h4>
            <input id="apiKey" type="text" class="form-control" pattern="[0-9a-zA-Z.]{1,32}" placeholder="example: df9c74ff1a47dcb48aab815fa5500429" title="Min. 1 max. 32 simbols">

            <h4>City ID :</h4>
            <input id="cityId" type="text" class="form-control" pattern="[0-9]{1,10}" placeholder="example: 598098" title="Min. 1 max. 10 simbols">

            <h4>Weather server:</h4>
            <input id="weatherServer" type="text" class="form-control" pattern="[0-9a-zA-Z.]{1,32}" placeholder="example: api.openweathermap.org" title="Min. 1 max 32 simbols">

            <h4>Weather language :</h4>
            <select id="langWeather" class="custom-select">
              <option value="ua">Ukrainian</option>
              <option value="en">English</option>
              <option value="ru">Russian</option>
            </select>
          </div>
        </div>
      </div>

      <div class="col-sm">
        <div class="card mx-auto">
          <div class="card-header">
            Options
          </div>
          <div class="card-body">
            <!-- <h4>Scroll speed:</h4>
            <input id="scrollSpeed" type="text" class="form-control">

            <div class="custom-control custom-switch switch">
              <input type="checkbox" class="custom-control-input" id="autoBright" name="example">
              <label class="custom-control-label" for="autoBright">Auto bright</label>
            </div>

            <h4>Bright :</h4>
            <form>
              <label for="customRange">Fixing bright</label>
              <input type="range" class="custom-range" id="customRange" name="points1">
            </form> -->



          </div>
        </div>
      </div>
    </div>

    <div class="col-sm">
      <div class="card mx-auto">
        <div class="card-header ">

          <div class="row" style="padding-left: 15px;">
            MQTT
            <label class="switch" style="margin-left: 120px;">
              <input type="checkbox" id="mqttOn" onclick="changeContent()">
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="card-body" id="mqtt">
          <h4">Server :</h4>
          <input id="mqttserver" type="text" class="form-control" pattern="[- 0-9a-zA-Z._/]{1,20}" placeholder="Example: m24.cloudmqtt.com" title="Min. 1 max 20 simbols">

          <h4>Port :</h4>
          <input id="mqttport" type="number" class="form-control" pattern="[\d]{5}" placeholder="Example: 17049" title="Only 5 simbols">

          <h4>User name :</h4>
          <input id="mqttUserName" type="text" class="form-control" pattern="[-\w\s#@/]{0,20}" placeholder="Example: zqyslfbd" title="Max. 20 simbols">

          <h4>User password :</h4>
          <input id="mqttpass" type="text" class="form-control" pattern="[-\w\s#@/]{0,20}" placeholder="Example: dK4mJd" title="Max. 20 simbols" >

          <h4>Device name :</h4>
          <input id="mqttname" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Informer" title="Min. 1 max. 24 simbols" >

          <h4 style="font-size: 110%;">Topic of inform message :</h4>
          <input id="mqttsubinform" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Inform/mess">

          <h4 style="font-size: 110%;">Topic of external temperature :</h4>
          <input id="mqttsub" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Ulica/temp" title="Min. 1 max. 24 simbols">

          <h4 style="font-size: 110%;">Topic of publication of temperature :</h4>
          <input id="mqttpubtemp" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Informer/temp" title="Min. 1 max. 24 simbols">

          <h4 style="font-size: 110%;">Topic of publication temp. streets :</h4>
          <input id="mqttpubtempUl" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Informer/tempUl" title="Min. 1 max. 24 simbols">

          <h4 style="font-size: 110%;">Topic of humidity publication :</h4>
          <input id="mqttpubhum" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Informer/hum" title="Min. 1 max. 24 simbols">

          <h4 style="font-size: 110%;">Press Release Topic :</h4>
          <input id="mqttpubpress" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Informer/press" title="Min. 1 max. 24 simbols">

          <!-- <h4>Altitude :</h4>
          <input id="mqttpubalt" type="text" class="inputData"> -->

          <h4 style="font-size: 110%;">Topic of publication of forecast :</h4>
          <input id="mqttpubforecast" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Informer/forecast" title="Min. 1 max. 24 simbols">

          <h4 style="font-size: 110%;">Topic of publication of button :</h4>
          <input id="mqttbutt" type="text" class="form-control" pattern="[-\w\s#@/]{1,24}" placeholder="Example: Informer/buton" title="Min. 1 max. 24 simbols">
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="footer mx-auto btn-footer">
      <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" onclick="saveButton()" data-target="#saveModal">Save</button>
      <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#rebootModal">Restart</button>
      <button type="button" class="btn btn-danger btn-lg"  data-toggle="modal" data-target="#resetModal">Reset</button>
      <button type="button" class="btn btn-outline-warning btn-lg"  data-toggle="modal" data-target="#helpModal">Help</button>

    </div>
  </div>

  <!-- Modal save-->
  <div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Save</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            After save, reboot required! Reboot clocks now?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal" onclick="restartButton()">Reboot</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal reboot -->
  <div class="modal fade" id="rebootModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Reboot</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            Reboot clocks now?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal" onclick="restartButton()">Reboot</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Modal reset-->
  <div class="modal fade" id="resetModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Reset</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            Reset to defaults?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal" onclick="getData()">Reset</button>
        </div>
      </div>
    </div>
  </div>
</div>

  <footer>
    <div class="row">
      <div class="col mx-auto">
        <div class=" text-center py-4">© 2019
          <a href="http://mechanicart.ho.ua" target="blank"> Shpakov Vladyslav</a> /
          <a href="http://mechanicart.ho.ua" target="blank"> sendsay34@gmail.com</a> /
          <a href="http://mechanicart.ho.ua" target="blank"> sendsay@yahoo.com</a> /
          <a href="http://mechanicart.ho.ua" target="blank"> sendsay@mail.ru</a>
        </div>
      </div>
    </div>
  </footer>


  <script>
    var xmlHttp = new XMLHttpRequest();

    function getData() {
      if(xmlHttp.readyState==0 || xmlHttp.readyState==4){
      xmlHttp.open('GET','/getData',true);
      xmlHttp.send();
      xmlHttp.onload = function(e) {

          var str = xmlHttp.responseText;

          json=JSON.parse(str);
          //wifi
          document.getElementById("ssid").value = json.ssid;
          document.getElementById("password").value = json.password;
          document.getElementById("ssidAP").value = json.ssidAP;
          document.getElementById("passwordAP").value = json.passwordAP;
          //time
          document.getElementById("timezone").value = json.timezone;
          if (json.summertime == 1) { document.getElementById("summerTime").checked = true; }
          document.getElementById("sigOn").value = json.sigOn;
          document.getElementById("sigOff").value = json.sigOff;
          document.getElementById("ntpServerName").value = json.ntpServerName;
          //weather
          document.getElementById("apiKey").value = json.apiKey;
          document.getElementById("cityId").value = json.cityId;
          document.getElementById("weatherServer").value = json.weatherServer;
          document.getElementById("langWeather").value = json.langWeather;
          //mqtt
          document.getElementById("mqttserver").value = json.mqttserver;
          document.getElementById("mqttport").value = json.mqttport;
          document.getElementById("mqttUserName").value = json.mqttUserName;
          document.getElementById("mqttpass").value = json.mqttpass;
          document.getElementById("mqttname").value = json.mqttname;
          document.getElementById("mqttsubinform").value = json.mqttsubinform;
          document.getElementById("mqttsub").value = json.mqttsub;
          document.getElementById("mqttpubtemp").value = json.mqttpubtemp;
          document.getElementById("mqttpubtempUl").value = json.mqttpubtempUl;
          document.getElementById("mqttpubhum").value = json.mqttpubhum;
          document.getElementById("mqttpubpress").value = json.mqttpubpress;
          // document.getElementById("mqttpubalt").value = json.mqttpubalt;
          document.getElementById("mqttpubforecast").value = json.mqttpubforecast;
          document.getElementById("mqttbutt").value = json.mqttbutt;
          if (json.mqttOn == 1) {
            document.getElementById("mqttOn").checked = true;
          } else {
            changeContent();
          }
        }
      }
    }

    function saveButton() {
      var content = "/saveContent?ssid=" + val('ssid') + "&password=" + val('password') + "&ssidAP=" + val('ssidAP') +
                    "&passwordAP=" + val('passwordAP') + "&timezone=" + val('timezone') + "&summertime=" + val_sw('summerTime') +
                    "&sigOn=" + val('sigOn') + "&sigOff=" + val('sigOff') + "&ntpServerName=" + val('ntpServerName') +
                    "&apiKey=" + val('apiKey') + "&cityId=" + val('cityId') + "&weatherServer=" + val('weatherServer') +
                    "&langWeather=" + val("langWeather") + "&mqttserver=" + val("mqttserver") + "&mqttport=" + val('mqttport') +
                    "&mqttUserName=" + val('mqttUserName') + "&mqttpass=" + val('mqttpass') + "&mqttname=" + val('mqttname') +
                    "&mqttsubinform=" + val('mqttsubinform') + "&mqttsub=" + val('mqttsub') + "&mqttpubtemp=" + val('mqttpubtemp') +
                    "&mqttpubtempUl=" + val('mqttpubtempUl') + "&mqttpubhum=" + val('mqttpubhum') +
                    "&mqttpubpress=" + val('mqttpubpress') + "&mqttpubforecast=" + val('mqttpubforecast') +
                    "&mqttbutt=" + val('mqttbutt') + "&mqttOn=" + val_sw('mqttOn');

      xmlHttp.open('GET', content,true);
      xmlHttp.send();

    }

    function restartButton() {
      xmlHttp.open("GET", "/restart", true);
      xmlHttp.send();
    }

    function val(id){
      var v = document.getElementById(id).value;
      return v;
    }

    function val_sw(nameSwitch) {
      switchOn = document.getElementById(nameSwitch);
      if (switchOn.checked){
        return 1;
      }
      return 0;
    }

    function changeContent() {
      var changeMqttOn = document.getElementById("mqttOn");
  
      var changeEnable;
      if (changeMqttOn.checked == false) {changeEnable = false;} else {changeEnable = true;}
      
      var mqttsection = document.getElementById("mqtt");
      var mqttinput = mqttsection.getElementsByTagName("input");

      for (let i= 0; i < 13; i++) {
        mqttinput[i].disabled = changeEnable;
      }
    }
  </script>

  <script src="jquery.min.js"></script>
  <script src="popper.min.js"></script>
  <script src="bootstrap.min.js"></script>

</body>
</html>
